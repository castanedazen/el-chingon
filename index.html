<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cruzando los Nopales â€” ICE Co. Guards</title>
<style>
  body { margin:0; font-family:sans-serif; background:#fff7e6; }
  h1 { text-align:center; color:#d32f2f; text-shadow:1px 1px #fff; }
  canvas { display:block; margin:12px auto; border:4px solid #000; border-radius:16px; background:#fff; }
  .hud { text-align:center; font-weight:bold; font-size:20px; }
</style>
</head>
<body>
  <h1>ðŸ‡²ðŸ‡½ Cruzando los Nopales</h1>
  <canvas id="game" width="800" height="600"></canvas>
  <div class="hud">Vidas: <span id="lives">3</span> | Puntos: <span id="score">0</span></div>

<script>
// --- CANVAS ---
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

// --- PLAYER ---
const playerImg=new Image();
playerImg.src="player.png";
let playerReady=false;
playerImg.onload=()=>{ playerReady=true; };

let player={x:380,y:500,w:60,h:120, speed:5};

// --- GUARDS (ICE Co.) ---
let guards=[];
function makeGuard(){
  return {
    x:Math.random()*740, y:-100,
    w:60,h:120, speed:2+Math.random()*2
  };
}

// --- GAME STATE ---
let lives=3, score=0, keys={};

// --- INPUT ---
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

// --- AUDIO ---
function playSound(type){
  let o=ctxAudio.createOscillator();
  let g=ctxAudio.createGain();
  o.connect(g); g.connect(ctxAudio.destination);
  g.gain.value=0.2; o.type="square";

  if(type==="win"){
    o.frequency.value=800;
    yepa();
  } else if(type==="fail"){
    o.frequency.value=120;
    yeeepa();
  }
  o.start(); o.stop(ctxAudio.currentTime+0.15);
}

function yepa(){
  let utter=new SpeechSynthesisUtterance("Â¡Ya chinguÃ©!");
  utter.lang="es-MX"; utter.pitch=2; utter.rate=1.2;
  speechSynthesis.speak(utter);
}
function yeeepa(){
  let utter=new SpeechSynthesisUtterance("Â¡Se chingÃ³!");
  utter.lang="es-MX"; utter.pitch=2; utter.rate=1.2;
  speechSynthesis.speak(utter);
}

// Background mariachi style
const ctxAudio=new (window.AudioContext||window.webkitAudioContext)();
function loopMariachi(){
  let o=ctxAudio.createOscillator();
  let g=ctxAudio.createGain();
  o.connect(g); g.connect(ctxAudio.destination);
  o.type="triangle";
  o.frequency.value=[220,330,440,330][Math.floor(Math.random()*4)];
  g.gain.value=0.05;
  o.start(); o.stop(ctxAudio.currentTime+0.3);
}
setInterval(loopMariachi,400);

// --- GAME LOOP ---
function update(){
  if(keys["ArrowLeft"]) player.x-=player.speed;
  if(keys["ArrowRight"]) player.x+=player.speed;
  if(keys["ArrowUp"]) player.y-=player.speed;
  if(keys["ArrowDown"]) player.y+=player.speed;

  player.x=Math.max(0,Math.min(canvas.width-player.w,player.x));
  player.y=Math.max(0,Math.min(canvas.height-player.h,player.y));

  if(Math.random()<0.02) guards.push(makeGuard());
  for(let g of guards){ g.y+=g.speed; }

  for(let g of guards){
    if(player.x<g.x+g.w && player.x+player.w>g.x &&
       player.y<g.y+g.h && player.y+player.h>g.y){
       lives--; playSound("fail");
       g.y=-200;
       if(lives<=0){ alert("Juego terminado!"); document.location.reload(); }
    }
  }

  if(player.y<=0){
    score+=10; playSound("win");
    player.x=380; player.y=500;
    guards=[];
  }
  document.getElementById("lives").textContent=lives;
  document.getElementById("score").textContent=score;
}

function draw(){
  ctx.fillStyle="#fff7e6";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(playerReady){
    ctx.drawImage(playerImg,player.x,player.y,player.w,player.h);
  } else {
    ctx.fillStyle="red";
    ctx.fillRect(player.x,player.y,player.w,player.h);
  }

  for(let g of guards){
    // draw guard body
    ctx.fillStyle="#111";
    ctx.fillRect(g.x,g.y,g.w,g.h);
    // head
    ctx.fillStyle="#fcd5b5";
    ctx.fillRect(g.x+15,g.y-20,30,30);
    // sunglasses
    ctx.fillStyle="#000";
    ctx.fillRect(g.x+15,g.y-10,30,10);
    // lapel "ICE Co."
    ctx.fillStyle="#fff";
    ctx.font="10px Arial";
    ctx.fillText("ICE Co.",g.x+5,g.y+20);
  }
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
